# Arch Wiki Gaming Optimizations
# https://wiki.archlinux.org/title/Gaming
# https://wiki.archlinux.org/title/Improving_performance

# ========================================
# Network Performance
# ========================================
# Reduce latency for gaming
net.core. netdev_max_backlog = 16384
net.core.rmem_default = 1048576
net.core.rmem_max = 16777216
net.core.wmem_default = 1048576
net.core.wmem_max = 16777216
net.ipv4.tcp_rmem = 4096 1048576 8388608
net.ipv4.tcp_wmem = 4096 65536 8388608
net.ipv4.tcp_fastopen = 3
net.ipv4.tcp_congestion_control = bbr
net.core.default_qdisc = fq
# net.core.default_qdisc = cake

# ========================================
# Memory Management
# ========================================
# Dirty page writeback (reduce stutter)
vm.dirty_ratio = 10
vm.dirty_background_ratio = 5
vm.dirty_expire_centisecs = 3000
vm.dirty_writeback_centisecs = 500
vm.max_map_count = 2147483642

# Transparent Huge Pages (THP) - use madvise for game compatibility
vm.compaction_proactiveness = 0
vm.page_lock_unfairness = 1

# ========================================
# Scheduler & CPU
# ========================================
# Reduce scheduler latency
kernel.sched_latency_ns = 4000000
kernel.sched_min_granularity_ns = 500000
kernel.sched_wakeup_granularity_ns = 50000
kernel.sched_migration_cost_ns = 250000
kernel.sched_nr_migrate = 32

# ========================================
# I/O & Storage
# ========================================
# Increase inotify limits for Steam/Lutris
fs.inotify. max_user_watches = 524288
fs.inotify. max_user_instances = 1024

# Wine/Proton esync/fsync limits
fs.file-max = 2097152

# AIO limits (for game engines)
fs.aio-max-nr = 1048576

# ========================================
# Security (Performance Tradeoffs)
# ========================================
# Disable spectre/meltdown mitigations (adds ~5-15% perf)
kernel.unprivileged_userns_clone = 1
