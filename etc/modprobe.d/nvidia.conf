# NVIDIA kernel module optimizations for Arch/Wayland/KDE6
# Refs: https://gist.github.com/denji/52b9b0980ef3dadde0ff3d3ccf74a2a6
#       https://docs.nvidia.com/nvshmem/release-notes-install-guide/

# Memory & PAT: Use Page Attribute Table for better management
# InitializeSystemMemoryAllocations=0: Skip mem clearing (perf boost, KDE6/Wayland sleep fix)
# DynamicPowerManagement: dGPU powerdown on mobile (Turing+)
# RegistryDwords combines frame-pacing, peer mapping, IBGDA fallback

options nvidia NVreg_UsePageAttributeTable=1 \
  NVreg_InitializeSystemMemoryAllocations=0 \
  NVreg_DynamicPowerManagement=0x02 \
  NVreg_EnableMSI=1 \
  NVreg_EnableGpuFirmware=1 \
  NVreg_EnablePCIeGen3=3 \
  NVreg_EnableStreamMemOPs=1 \
  NVreg_EnableResizableBar=1 \
  NVreg_RegistryDwords=RmEnableAggressiveVblank=1,RMIntrLockingMode=1,PeerMappingOverride=1

# Modesetting: CRITICAL for Wayland/PRIME (GBM, atomic KMS)
options nvidia-drm modeset=1 fbdev=1
