id: py-loop-performance
language: python
severity: warning
message: Optimize loop pattern
note: "String concat: use list+join; Regex: precompile; Loops: use comprehension"
rule:
  any:
    - kind: augmented_assignment
      pattern: $VAR += $STR
      inside:
        any:
          - kind: for_statement
          - kind: while_statement
    - pattern: re.$METHOD($PATTERN, $$$)
      inside:
        any:
          - kind: for_statement
          - kind: while_statement
    - kind: for_statement
      pattern: |
        for $VAR in $ITER:
          $LIST.append($EXPR)
fix: $LIST = [$EXPR for $VAR in $ITER]
---
id: py-prefer-idioms
language: python
severity: info
message: Use Python idiom for cleaner code
note: "f-strings > format(); dict.get() > if key in dict; set for membership; Path over os.path"
rule:
  any:
    - pattern: $STR.format($$$)
    - kind: if_statement
      pattern: |
        if $KEY in $DICT:
          $VAR = $DICT[$KEY]
        else:
          $VAR = $DEFAULT
    - pattern: os.path.exists($PATH)
    - kind: comparison_operator
      pattern: $VAR in $LIST
      has:
        kind: list
fix: $VAR = $DICT.get($KEY, $DEFAULT)
---
id: py-dataclass-slots
language: python
severity: info
message: Add slots=True to dataclass (saves memory, faster attribute access)
note: "@dataclass(slots=True) - Python 3.10+"
rule:
  kind: decorated_definition
  has:
    kind: decorator
    pattern: "@dataclass"
    not:
      regex: "slots=True"
fix: "@dataclass(slots=True)"
