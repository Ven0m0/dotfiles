[unstable]
unstable-options = true
mtime-on-use = true
avoid-dev-deps = true
git = true
gitoxide = true
checksum-freshness = true
cargo-lints = true
trim-paths = true
no-embed-metadata = true
build-std = ["std", "panic_abort"]
build-std-features = ["panic_immediate_abort"]
gc = true
panic-abort-tests = true
script = true
binary-dep-depinfo = true
codegen-backend = true

[alias]
b = "build"
i = "install"
rr = "run -r"
insta = "+nightly -Zunstable-options -Zmtime-on-use -Zgit -Zgitoxide -Zbuild-std=std,panic_abort -Zbuild-std-features=panic_immediate_abort -Zavoid-dev-deps -Zno-embed-metadata install -f --bins --ignore-rust-version -q"
builda = "+nightly -Zunstable-options -Zmtime-on-use -Zgit -Zgitoxide -Zbuild-std=std,panic_abort -Zbuild-std-features=panic_immediate_abort -Zavoid-dev-deps -Zno-embed-metadata build --bins --lib -r -q"
installgit = "+nightly -Zunstable-options -Zmtime-on-use -Zgit -Zgitoxide -Zbuild-std=std,panic_abort -Zbuild-std-features=panic_immediate_abort -Zavoid-dev-deps -Zno-embed-metadata install -f --bins -q --git"

[rust]
jemalloc = true
lto = 'fat'
optimize = true
strip = true
validate-mir-opts = 3
codegen-units = 1
codegen-units-std = 1
debuginfo-level-std = 0
debug = false
frame-pointers = false
codegen-backends = ['llvm']

[llvm]
libzstd = true
optimize = true
polly = true
clang = true

[build]
rustc-wrapper = "sccache"
incremental = false
jobs = 0
pipelining = true
compiler-docs = false
optimized-compiler-builtins = true
ccache = true

# https://doc.rust-lang.org/cargo/reference/environment-variables.html
[env]
RUSTC_BOOTSTRAP = "1"
CARGO_CACHE_RUSTC_INFO = "1"
RUSTC_ICE = "0"
CARGO_LOG = "off"
RUSTDOC_LOG = "off"
RUSTC_LOG = "off"
MALLOC_CONF = "metadata_thp:auto,tcache:true,background_thread:true,percpu_arena:percpu,dirty_decay_ms:0,muzzy_decay_ms:0"
_RJEM_MALLOC_CONF = "metadata_thp:auto,tcache:true,background_thread:true,percpu_arena:percpu,dirty_decay_ms:0,muzzy_decay_ms:0"
MIMALLOC_ALLOW_LARGE_OS_PAGES = "1"
ZSTD_NBTHREADS = "0"
RUST_LIB_BACKTRACE = "0"
CMAKE_BUILD_TYPE = "Release"
OPT_LEVEL = "3"
CARGO_INCREMENTAL = "0"

[cache]
auto-clean-frequency = "7 days"

[cache.global-clean]
max-src-age = "1 month"
max-crate-age = "2 months"
max-index-age = "2 months"
max-git-co-age = "1 month"
max-git-db-age = "1 months"

[http]
debug = false
ssl-version.max = "tlsv1.3"
ssl-version.min = "tlsv1.2"
timeout = 30
check-revoke = false
multiplexing = true
low-speed-limit = 10

[net]
git-fetch-with-cli = true
retry = 2
offline = false

[registries.crates-io]
protocol = "sparse"

[resolver]
incompatible-rust-versions = "allow"

[profile.release]
opt-level = 3
codegen-units = 1
lto = "fat"
panic = "abort"
strip = "symbols"
debug = false
debug-assertions = false
overflow-checks = false
incremental = false
rpath = false

[target.x86_64-unknown-linux-gnu]
linker = "clang"
ar = 'llvm-ar'
ranlib = 'llvm-ranlib'
rustflags = [
  "-C", "target-cpu=native","-Z", "tune-cpu=native",
  "-C", "link-arg=-Wl,--icf=safe", "-C", "link-arg=-Wl,--as-needed", "-C", "link-arg=-Wl,--gc-sections",
  "-C", "link-arg=-Wl,--lto-O3", "-C", "link-arg=-Wl,--threads=8", "-C", "link-arg=-Wl,--fat-lto-objects" "-C", "link-arg=-Wl,--optimize-bb-jumps"
  "-C", "link-args=-fuse-ld=lld", "-C", "linker-plugin-lto", "-C", "embed-bitcode=yes",
  "-Z", "virtual-function-elimination", "-Z", "function-sections"
  "-C", "llvm-args=-enable-dfa-jump-thread -enable-new-pm=1", "-Z", "precise-enum-drop-elaboration=yes",
  "-Z", "share-generics=y", "-Z", "plt",
  "-Z", "mir-opt-level=4", "-Z", "threads=8",
  "-Z", "location-detail=none", "-Z", "fmt-debug=none",
]

[profile.dev]
opt-level = 1
codegen-units = 256
incremental = true
debug = "line-tables-only"
split-debuginfo = "unpacked"

[profile.dev.package."*"]
opt-level = 2
debug = false

[profile.release.build-override]
inherits = "release"
codegen-units = 16

[term]
quiet = false
verbose = false
unicode = true
hyperlinks = true
color = "auto"
progress.when = "auto"
progress.term-integration = true
