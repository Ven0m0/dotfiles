[unstable]
unstable-options = true
mtime-on-use = true
avoid-dev-deps = true
git = true
gitoxide = true
checksum-freshness = true
cargo-lints = true
trim-paths = true
no-embed-metadata = true
build-std = ["std", "panic_abort"]
build-std-features = ["panic_immediate_abort"]
gc = true
panic-abort-tests = true

[alias]
b = "build"
i = "install"
rr = "run -r"
insta = "+nightly install -f --bins --ignore-rust-version"
builda = "+nightly build --bins --lib -r"
installgit = "+nightly install -f --bins --git"

[rust]
jemalloc = true
optimize = true

[build]
rustc-wrapper = "sccache"
incremental = false

# https://doc.rust-lang.org/cargo/reference/environment-variables.html
[env]
RUSTC_BOOTSTRAP = "1"
CARGO_CACHE_RUSTC_INFO = "1"
RUSTC_ICE = "0"
CARGO_LOG = "off"
RUSTDOC_LOG = "off"
RUSTC_LOG = "off"
MALLOC_CONF = "metadata_thp:auto,tcache:true,background_thread:true,percpu_arena:percpu,dirty_decay_ms:0,muzzy_decay_ms:0"
_RJEM_MALLOC_CONF = "metadata_thp:auto,tcache:true,background_thread:true,percpu_arena:percpu,dirty_decay_ms:0,muzzy_decay_ms:0"
MIMALLOC_ALLOW_LARGE_OS_PAGES = "1"
RUST_LIB_BACKTRACE = "0"
CMAKE_BUILD_TYPE = "Release"
CARGO_INCREMENTAL = "0"

[cache]
auto-clean-frequency = "7 days"

[cache.global-clean]
max-src-age = "1 month"
max-crate-age = "2 months"
max-index-age = "2 months"
max-git-co-age = "1 month"
max-git-db-age = "1 months"

[http]
timeout = 30
check-revoke = false
multiplexing = true
low-speed-limit = 10

[net]
git-fetch-with-cli = true
retry = 2

[registries.crates-io]
protocol = "sparse"

[resolver]
incompatible-rust-versions = "allow"

[profile.release]
opt-level = 3
codegen-units = 1
lto = "fat"
panic = "immediate-abort"
#panic = "abort"
strip = "symbols"
debug = false
debug-assertions = false
overflow-checks = false
incremental = false
rpath = false

[profile.dev]
opt-level = 1
codegen-units = 256
incremental = true
debug = "line-tables-only"
split-debuginfo = "unpacked"

[profile.dev.package."*"]
opt-level = 2
debug = false

[profile.release.build-override]
inherits = "release"
codegen-units = 16

[target.x86_64-unknown-linux-gnu]
linker = "clang"
rustflags = [
  "-C", "target-cpu=native","-Z", "tune-cpu=native",
  "-C", "link-arg=-fuse-ld=mold", "-C", "link-arg=-Wl,--icf=safe,--as-needed,--gc-sections",
  "-C", "llvm-args=-enable-dfa-jump-thread", "-Z", "precise-enum-drop-elaboration=yes",
  "-Z", "share-generics=y", "-Z", "plt",
  "-Z", "mir-opt-level=4", "-Z", "threads=8",
  "-Z", "location-detail=none", "-Z", "fmt-debug=none",
]

[term]
quiet = false
verbose = false
hyperlinks = true
color = "auto"
progress.when = "auto"
progress.term-integration = true
