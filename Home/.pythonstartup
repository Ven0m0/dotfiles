import atexit
import os
import readline
import sys
import json
from pprint import pprint

# 1. Enable Tab Completion
try:
    import readline
    import rlcompleter
    readline.parse_and_bind("tab: complete")
except ImportError:
    pass

# 2. Enable History Saving (XDG Compliant)
# Stores history in ~/.local/state/python/history instead of cluttering ~
xdg_state_home = os.environ.get('XDG_STATE_HOME', os.path.expanduser('~/.local/state'))
history_dir = os.path.join(xdg_state_home, 'python')
history_file = os.path.join(history_dir, 'history')

# Ensure directory exists
os.makedirs(history_dir, exist_ok=True)
try:
    readline.read_history_file(history_file)
except FileNotFoundError:
    pass
# Save history on exit
atexit.register(readline.write_history_file, history_file)

# 3. Pretty Printing by Default
# Any expression result will be pretty-printed instead of standard print()
def my_displayhook(value):
    if value is not None:
        try:
            import builtins
            builtins._ = value
        except ImportError:
            __builtins__._ = value
        pprint(value)

sys.displayhook = my_displayhook

# 4. Welcome Message
print(f"\nüêç Python {sys.version.split()[0]} Startup Script Loaded.")
print(f"   ‚Ä¢ History saved to: {history_file}")
print(f"   ‚Ä¢ Tab completion enabled.")
print(f"   ‚Ä¢ Auto-imports: os, sys, json, pprint\n")
